<div class="cont">
  <mat-card>
    <div class="header">
      <div class="linha-1">
        <div class="titulos-header">
          <mat-card-title>
            <span class="material-symbols-outlined"> payments</span>
            <span>Títulos</span>
          </mat-card-title>
          <mat-card-subtitle>Filtros</mat-card-subtitle>
        </div>

        <div class="totais">
          <div>
            Status:
            <h2>{{stt}}</h2>
          </div>

          <div>
            Qtd:
            <h2>{{result.length}}</h2>
          </div>

          <div>
            Total:
            <h2>{{valorTotal}}</h2>
          </div>
          
        </div>
      </div>

      <div class="linha-2">
        <div class="btns">
          <button type="button" [disabled]="desabilitarBtnStatus" class="btn btn-danger btn-sm" (click)="alterarStatus('Cadastrado')">Cadastrado</button>
          <button type="button" [disabled]="desabilitarBtnStatus" class="btn btn-warning btn-sm" (click)="alterarStatus('Lançado')">Lançado</button>
          <button type="button" [disabled]="desabilitarBtnStatus" class="btn btn-primary btn-sm" (click)="alterarStatus('Aprovado')">Aprovado</button>
          <button type="button" [disabled]="desabilitarBtnStatus" class="btn btn-success btn-sm" (click)="alterarStatus('Entregue')">Entregue</button>
        </div>
        <div>
          <button mat-raised-button color="primary" routerLink="/cadastrar-titulo"><mat-icon>add</mat-icon></button>
          <button mat-icon-button [disabled]="btnRelatorio" (click)="gerarProtocolo()">
            <span class="material-symbols-outlined">file_open</span>
          </button>

          <a (click)="gerarExcel()"  mat-button>Link</a>
        </div>
      </div>

      <div class="container-filtros">
        <mat-form-field appearance="outline" color="primary">
          <mat-label>Status</mat-label>
          <mat-select  (selectionChange)="filterStatus($event)" [(ngModel)]="stt">
              <mat-option  *ngFor="let row of status" [value]="row.status">{{ row.status }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Filtro</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Ex: Num_NF" [(ngModel)]="filtro">
        </mat-form-field>
      </div>
    </div>
  </mat-card>

  <mat-card>
    <div class="linha-1">
      <div class="titulos-header">
        <mat-card-title>
          <span class="material-symbols-outlined"> list</span>
          Lista de Títulos
        </mat-card-title>
        <mat-card-subtitle *ngIf="result.length == 0">Nenhum título cadastrado com o Status: {{stt}} </mat-card-subtitle>
      </div>
      <div style="width: 14%; text-align: end; color: #3f51b5;">
        Total Selecionado:
        <h2>{{ valorStr }}</h2>
      </div>
    </div>
    <mat-card-content class="content-card-2" [hidden]="result.length == 0">
      <div class="container-table">
        <table mat-table [dataSource]="dataSource" matSort (matSortChange)="announceSortChange($event)"
          class="mat-elevation-z8 tabela"
        >
          <ng-container matColumnDef="sel">
            <th mat-header-cell *matHeaderCellDef>
              <mat-checkbox
                [(ngModel)]="parentSelect"
                [value]='-1'
                (change)="onChangeTitulo($event)"
              >
              </mat-checkbox>
            </th>
            <td mat-cell *matCellDef="let row">
              <mat-checkbox
              [checked]="row.sel"
              [value]="row.id_titulo"
              (change)="onChangeTitulo($event)"

              >
              </mat-checkbox>
            </td>
          </ng-container>

          <ng-container matColumnDef="nome_fornecedor">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by fornecedor">
              FORNECEDOR
            </th>
            <td mat-cell *matCellDef="let titulo"> {{titulo.nome_fornecedor}} </td>
          </ng-container>

          <ng-container matColumnDef="nome_item">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by item">
              ITEM
            </th>
            <td mat-cell *matCellDef="let titulo"> {{titulo.nome_item}} </td>
          </ng-container>

          <ng-container matColumnDef="cod_fornecedor">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by cod_fornecedor">
              COD_FORN
            </th>
            <td mat-cell *matCellDef="let titulo"> {{titulo.cod_fornecedor}} </td>
          </ng-container>


          <ng-container matColumnDef="nf_tit">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by num_nf">
              NUM_NF
            </th>
            <td mat-cell *matCellDef="let titulo"> {{titulo.nf_tit}} </td>
          </ng-container>

          <ng-container matColumnDef="nome_interface">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by datasul">
              DATASUL
            </th>
            <td mat-cell *matCellDef="let titulo"> {{titulo.nome_interface}} </td>
          </ng-container>

          <ng-container matColumnDef="data_emissao_tit">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by emissão">
              EMISSÃO
            </th >
            <td class="data-center" mat-cell *matCellDef="let titulo"> {{titulo.data_emissao_tit | date: 'dd/MM/yyyy'}} </td>
          </ng-container>

          <ng-container matColumnDef="data_venc_tit">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by vencimento">
              VENCIMENTO
            </th>
            <td class="data-center" mat-cell *matCellDef="let titulo"> {{titulo.data_venc_tit | date: 'dd/MM/yyyy'}} </td>
          </ng-container>

          <ng-container matColumnDef="data_entregue">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by entregue">
              ENTREGUE
            </th>
            <td class="data-center" class="data-center" mat-cell *matCellDef="let titulo"> {{titulo.data_entregue ? (titulo.data_entregue | date: 'dd/MM/yyyy') : '-' }} </td>
          </ng-container>

          <ng-container matColumnDef="valor_tit">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by valor">
              VALOR
            </th>
            <td mat-cell *matCellDef="let titulo"> {{titulo.valor_tit | currency : 'BRL'}} </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by status">
              STATUS
            </th>
            <td mat-cell *matCellDef="let titulo">
              <button #btn
                type="button"
                class="btn btn-sm"
                [ngClass]="{'btn-cadastrado': titulo.status == 'Cadastrado', 'btn-lancar': titulo.status == 'Lançado', 'btn-aprovar': titulo.status == 'Aprovado', 'btn-entregar': titulo.status == 'Entregue'}">
                {{titulo.status}}
              </button>
            </td>
          </ng-container>

          <ng-container matColumnDef="acao">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by status"></th>
            <td mat-cell *matCellDef="let titulo">
              <button mat-icon-button color="primary" (click)="detalheTitulo(titulo)" ><mat-icon class="material-symbols-outlined">search</mat-icon></button>
              <button mat-icon-button color="warn" (click)="deletarTiutlo(titulo)" *ngIf="titulo.status != 'Entregue'" >
                <mat-icon class="material-symbols-outlined">delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" [ngClass]="{'selected-row': row.sel == true, 'not-selected': !row.sel }"></tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>
</div>
